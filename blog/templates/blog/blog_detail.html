{% extends "base.html" %}
{% load crispy_forms_tags %}
{% load static %}

{% block content %}
<div class="container py-5">

  <!-- BLOG -->
  <div class="card shadow rounded-4 mb-4">
    {% if blog.photo %}
      <img src="{{ blog.photo.url }}" class="card-img-top" style="max-height:400px;object-fit:cover;">
    {% endif %}
    <div class="card-body">
      <h2>{{ blog.title }}</h2>
      <p class="text-muted">
        By {{ blog.author.username }}
        <span class="badge bg-secondary">{{ blog.author.role }}</span>
        â€¢ {{ blog.created_at|date:"F j, Y" }}
      </p>
      <p>{{ blog.content|safe }}</p>
    </div>
  </div>

  <!-- COMMENTS -->
  <div class="card p-4 rounded-4 shadow">
    <h4>Comments</h4>

    {% for comment in top_comments %}
      {% include "blog/comment_item.html" with comment=comment level=0 %}
    {% empty %}
      <p>No comments yet.</p>
    {% endfor %}

    <hr>

    {% if user.is_authenticated %}
      <form method="post">
        {% csrf_token %}
        {{ comment_form.comment_text|as_crispy_field }}
        <button class="btn btn-primary mt-2">Comment</button>
      </form>
    {% else %}
      <p>Please login to comment.</p>
    {% endif %}
  </div>
</div>

<script>
document.addEventListener("click", function(e){
  if(e.target.classList.contains("reply-btn")){
    e.preventDefault();
    const id = e.target.dataset.id;
    document.getElementById("reply-form-"+id).classList.toggle("d-none");
  }
});
</script>
{% endblock %}

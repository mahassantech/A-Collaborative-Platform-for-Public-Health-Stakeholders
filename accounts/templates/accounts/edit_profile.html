{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-7">

      <div class="card shadow-sm border-0 rounded-4 p-4">

        <!-- Profile Picture -->
        <div class="text-center mb-4">
          {% if user.profile_pic %}
            <img src="{{ user.profile_pic.url }}" class="rounded-circle border shadow-sm" width="120" height="120" style="object-fit:cover;">
          {% else %}
            <img src="{% static 'images/default-avatar.png' %}" class="rounded-circle border shadow-sm" width="120" height="120">
          {% endif %}
        </div>

        <h4 class="text-center fw-bold mb-4">Edit Profile</h4>

        <form method="POST" enctype="multipart/form-data">
          {% csrf_token %}

          <!-- Username & Email -->
          <div class="mb-3">
            {{ user_form.username.label_tag }}
            {{ user_form.username }}
          </div>
          <div class="mb-3">
            {{ user_form.email.label_tag }}
            {{ user_form.email }}
          </div>

          <!-- Profile Pic -->
          <div class="mb-3">
            {{ user_form.profile_pic.label_tag }}
            {{ user_form.profile_pic }}
          </div>

          <!-- Role -->
          <div class="mb-3">
            {{ user_form.role.label_tag }}
            {{ user_form.role }}
          </div>

          <!-- Doctor Fields -->
          <div id="doctor-fields" class="card bg-light border-0 p-3 mb-3">
            <h6 class="fw-bold mb-3 text-primary">Doctor Information</h6>

            <div class="mb-3">
              {{ user_form.degrees.label_tag }}
              {{ user_form.degrees }}
            </div>

            <div class="mb-3">
              {{ user_form.position.label_tag }}
              {{ user_form.position }}
            </div>

            <div class="mb-3">
              {{ user_form.doctor_license.label_tag }}
              {{ user_form.doctor_license }}
            </div>

            <div class="mb-3">
              {{ user_form.specialization.label_tag }}
              {{ user_form.specialization }}
              <small class="text-muted d-block">Hold Ctrl (Cmd) to select multiple</small>
            </div>

            <div class="mb-3">
              {{ user_form.hospital_name.label_tag }}
              {{ user_form.hospital_name }}
            </div>

            <div class="mb-3">
              {{ user_form.about_me.label_tag }}
              {{ user_form.about_me }}
            </div>

            <div class="mb-3">
              {{ user_form.phone_number.label_tag }}
              {{ user_form.phone_number }}
            </div>

            <div class="mb-3">
              {{ user_form.gender.label_tag }}
              {{ user_form.gender }}
            </div>
          </div>

          <button class="btn btn-primary w-100 py-2 fw-semibold">Save Changes</button>
        </form>

      </div>
    </div>
  </div>
</div>

<script>
  const roleField = document.getElementById("id_role");
  const doctorFields = document.getElementById("doctor-fields");

  function toggleDoctorFields() {
    if (roleField.value === "doctor") {
      doctorFields.style.display = "block";
    } else {
      doctorFields.style.display = "none";
    }
  }

  document.addEventListener("DOMContentLoaded", toggleDoctorFields);
  if(roleField){
    roleField.addEventListener("change", toggleDoctorFields);
  }
</script>
{% endblock %}

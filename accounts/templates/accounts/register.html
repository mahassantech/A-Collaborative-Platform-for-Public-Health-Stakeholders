{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="d-flex justify-content-center align-items-center medical-bg" style="min-height:100vh; padding:20px; background: linear-gradient(135deg,#7d93a7ff,#b5c6d3ff);">
    <div class="card shadow-lg p-4 medical-card" style="width:450px;">
        <div class="text-center mb-4">
            <h4 class="fw-bold text-primary mt-2">HealthConnect</h4>
            <p class="text-muted small">Create your account</p>
        </div>

        {% if form.errors %}
        <div class="alert alert-danger">
            <ul class="mb-0">
                {% for field in form %}
                    {% for error in field.errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                {% endfor %}
                {% for error in form.non_field_errors %}
                    <li>{{ error }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}

            <!-- Username -->
            <div class="mb-3">
                <label for="id_username" class="form-label fw-semibold">Username</label>
                <input type="text" name="username" id="id_username" class="form-control" value="{{ form.username.value|default_if_none:'' }}">
            </div>

            <!-- Email -->
            <div class="mb-3">
                <label for="id_email" class="form-label fw-semibold">Email</label>
                <input type="email" name="email" id="id_email" class="form-control" value="{{ form.email.value|default_if_none:'' }}">
            </div>

            <!-- Password -->
            <div class="mb-3">
                <label for="id_password" class="form-label fw-semibold">Password</label>
                <input type="password" name="password" id="id_password" class="form-control">
            </div>

            <!-- Role -->
            <div class="mb-3">
                <label for="id_role" class="form-label fw-semibold">Role</label>
                <select name="role" id="id_role" class="form-select">
                    <option value="patient" {% if form.role.value == "patient" %}selected{% endif %}>Patient</option>
                    <option value="doctor" {% if form.role.value == "doctor" %}selected{% endif %}>Doctor</option>
                    <option value="analyst" {% if form.role.value == "analyst" %}selected{% endif %}>Data Analyst</option>
                </select>
            </div>

            <!-- Doctor fields -->
            <div id="doctor-fields" style="display:none;">
                <!-- Doctor License -->
                <div class="mb-3">
                    <label for="id_doctor_license" class="form-label fw-semibold">Doctor License</label>
                    <input type="text" name="doctor_license" id="id_doctor_license" class="form-control" value="{{ form.doctor_license.value|default_if_none:'' }}">
                </div>

                <!-- Specializations -->
                <div class="mb-3">
                    <label for="id_specialization" class="form-label fw-semibold">Specializations</label>
                    <select name="specialization" id="id_specialization" class="form-select" multiple>
                        {% for spec in form.fields.specialization.queryset %}
                            <option value="{{ spec.id }}"
                                {% if spec in form.instance.specialization.all %}selected{% endif %}>
                                {{ spec.name }}
                            </option>
                        {% endfor %}
                    </select>
                    <small class="text-muted">Hold Ctrl (Cmd on Mac) to select multiple</small>
                </div>

                <!-- Hospital Name -->
                <div class="mb-3">
                    <label for="id_hospital_name" class="form-label fw-semibold">Hospital Name</label>
                    <input type="text" name="hospital_name" id="id_hospital_name" class="form-control" value="{{ form.hospital_name.value|default_if_none:'' }}">
                </div>
            </div>

            <!-- Profile Picture -->
            <div class="mb-3">
                <label for="id_profile_pic" class="form-label fw-semibold">Profile Picture</label>
                <input type="file" name="profile_pic" id="id_profile_pic" class="form-control">
            </div>

            <button type="submit" class="btn btn-primary w-100 fw-bold py-2 mt-3">Create Account</button>
        </form>

        <p class="text-center mt-3 small">
            Already have an account? 
            <a class="text-decoration-none text-primary fw-semibold" href="{% url 'login' %}">Sign In</a>
        </p>
    </div>
</div>

<script>
const roleSelect = document.getElementById("id_role");
const doctorFields = document.getElementById("doctor-fields");

function checkRole() {
    doctorFields.style.display = (roleSelect.value === "doctor") ? "block" : "none";
}

window.onload = checkRole;
roleSelect.addEventListener("change", checkRole);
</script>
{% endblock %}

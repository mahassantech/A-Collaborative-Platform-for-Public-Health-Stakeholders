{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="d-flex justify-content-center align-items-center medical-bg"
     style="min-height:40vh; padding:10px; background: linear-gradient(135deg,#7d93a7ff,#b5c6d3ff);">

    <div class="card shadow medical-card p-3" style="width:380px;">
        <div class="text-center mb-3">
            <h5 class="fw-bold text-primary mb-1">HealthConnect</h5>
            <p class="text-muted small mb-0">Create your account</p>
        </div>

        {% if form.errors %}
        <div class="alert alert-danger py-2 small">
            <ul class="mb-0">
                {% for field in form %}
                    {% for error in field.errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                {% endfor %}
                {% for error in form.non_field_errors %}
                    <li>{{ error }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}

            <div class="mb-2">
                <label class="form-label small fw-semibold">Username</label>
                <input type="text" name="username" class="form-control form-control-sm">
            </div>
            <div class="mb-2">
  <label class="form-label small fw-semibold">First Name</label>
  <input type="text" 
         name="first_name" 
         value="{{ user.first_name }}"
         class="form-control form-control-sm">
</div>

<div class="mb-2">
  <label class="form-label small fw-semibold">Last Name</label>
  <input type="text" 
         name="last_name" 
         value="{{ user.last_name }}"
         class="form-control form-control-sm">
</div>


            <div class="mb-2">
                <label class="form-label small fw-semibold">Email</label>
                <input type="email" name="email" class="form-control form-control-sm">
            </div>

            <div class="mb-2">
                <label class="form-label small fw-semibold">Password</label>
                <input type="password" name="password" class="form-control form-control-sm">
            </div>

            <div class="mb-2">
                <label class="form-label small fw-semibold">Role</label>
                <select name="role" id="id_role" class="form-select form-select-sm">
                    <option value="patient">Patient</option>
                    <option value="doctor">Doctor</option>
                    <option value="analyst">Data Analyst</option>
                </select>
            </div>

            <div id="doctor-fields" style="display:none;">
                <div class="mb-2">
                    <label class="form-label small fw-semibold">Doctor License</label>
                    <input type="text" name="doctor_license" class="form-control form-control-sm">
                </div>

                <div class="mb-2">
                    <label class="form-label small fw-semibold">Specializations</label>
                    <select name="specialization" class="form-select form-select-sm" multiple>
                        {% for spec in form.fields.specialization.queryset %}
                            <option value="{{ spec.id }}">{{ spec.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="mb-2">
                    <label class="form-label small fw-semibold">Hospital Name</label>
                    <input type="text" name="hospital_name" class="form-control form-control-sm">
                </div>
            </div>

            <div class="mb-2">
                <label class="form-label small fw-semibold">Profile Picture</label>
                <input type="file" name="profile_pic" class="form-control form-control-sm">
            </div>

            <button type="submit" class="btn btn-primary w-100 fw-semibold py-1 mt-2">
                Create Account
            </button>
        </form>

        <p class="text-center mt-2 small mb-0">
            Already have an account?
            <a href="{% url 'login' %}" class="fw-semibold text-primary text-decoration-none">Sign In</a>
        </p>
    </div>
</div>

<script>
const roleSelect = document.getElementById("id_role");
const doctorFields = document.getElementById("doctor-fields");

function checkRole() {
    doctorFields.style.display = roleSelect.value === "doctor" ? "block" : "none";
}
checkRole();
roleSelect.addEventListener("change", checkRole);
</script>
{% endblock %}
